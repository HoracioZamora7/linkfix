<form th:action="@{/registro}" th:object="${usuario}" method="post">
    <!-- Campos de persona -->
    <input type="text" th:field="*{nombre}" placeholder="Nombre">
    <input type="text" th:field="*{apellidos}" placeholder="Apellidos">
    <!-- Otros campos -->

    <!-- Departamento -->
    <select id="departamento" name="departamento">
        <option value="">Seleccione departamento</option>
        <option th:each="dep : ${departamentos}" 
                th:value="${dep.id}" 
                th:text="${dep.name}">
        </option>
    </select>

    <!-- Provincia (dinámica) -->
    <select id="provincia" name="provincia">
        <option value="">Seleccione provincia</option>
    </select>

    <!-- Distrito (dinámica) -->
    <select id="distrito" name="distrito">
        <option value="">Seleccione distrito</option>
    </select>

    <button type="submit">Registrar</button>
</form>

<script>
    document.getElementById("departamento").addEventListener("change", function () {
        const deptId = this.value;
        fetch(`/api/provincia/listarPorDepartamento?departmentId=${deptId}`)
            .then(res => res.json())
            .then(data => {
                const provinciaSelect = document.getElementById("provincia");
                provinciaSelect.innerHTML = '<option value="">Seleccione provincia</option>';
                data.forEach(p => {
                    provinciaSelect.innerHTML += `<option value="${p.id}">${p.name}</option>`;
                });
                // Limpiar distritos al cambiar de provincia
                document.getElementById("distrito").innerHTML = '<option value="">Seleccione distrito</option>';
            });
    });

    document.getElementById("provincia").addEventListener("change", function () {
        const provId = this.value;
        fetch(`/api/distrito/listarPorProvincia?provinceId=${provId}`)
            .then(res => res.json())
            .then(data => {
                const distritoSelect = document.getElementById("distrito");
                distritoSelect.innerHTML = '<option value="">Seleccione distrito</option>';
                data.forEach(d => {
                    distritoSelect.innerHTML += `<option value="${d.id}">${d.name}</option>`;
                });
            });
    });
</script>
